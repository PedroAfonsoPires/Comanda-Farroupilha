<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Comanda Farroupilha</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-green-50 to-yellow-50">

  <!-- Header -->
  <div class="bg-gradient-to-r from-green-700 via-red-600 to-yellow-500 text-white p-4 shadow-lg">
    <div class="max-w-6xl mx-auto text-center">
      <h1 class="text-2xl font-bold">游낎 Sistema de Vendas - Cerim칪nia Farroupilha 游낎</h1>
      <p class="text-sm opacity-90">Cap칤tulo Bag칠 n췈 91 - Ordem DeMolay | <span id="eventDate"></span></p>
      <div class="grid grid-cols-3 gap-4 mt-4">
        <div class="bg-white/20 rounded-lg p-2">
          <div id="totalRevenue" class="text-lg font-bold">R$ 0,00</div>
          <div class="text-xs">Faturamento</div>
        </div>
        <div class="bg-white/20 rounded-lg p-2">
          <div id="totalSales" class="text-lg font-bold">0</div>
          <div class="text-xs">Vendas</div>
        </div>
        <div class="bg-white/20 rounded-lg p-2">
          <div id="totalItemsSold" class="text-lg font-bold">0</div>
          <div class="text-xs">Itens Vendidos</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main -->
  <div class="max-w-6xl mx-auto p-4">
    <!-- Tabs -->
    <div class="flex justify-center gap-2 mb-6">
      <button onclick="showTab('vendas')" class="tab-btn bg-green-600 text-white px-4 py-2 rounded-lg">Vendas</button>
      <button onclick="showTab('estoque')" class="tab-btn bg-white px-4 py-2 rounded-lg border">Estoque</button>
      <button onclick="showTab('relatorios')" class="tab-btn bg-white px-4 py-2 rounded-lg border">Relat칩rios</button>
    </div>

    <!-- Vendas -->
    <div id="tab-vendas" class="grid lg:grid-cols-3 gap-6">
      <!-- Produtos -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h2 class="text-xl font-bold mb-4 text-green-800">Produtos Dispon칤veis</h2>
          <div id="productList" class="grid sm:grid-cols-2 gap-4"></div>
        </div>
      </div>
      <!-- Carrinho -->
      <div class="bg-white rounded-xl shadow-lg p-6">
        <h2 class="text-xl font-bold mb-4 text-green-800">Carrinho (<span id="cartCount">0</span> itens)</h2>
        <div id="cartItems" class="space-y-3 mb-6"></div>
        <div class="border-t pt-4">
          <div class="flex justify-between text-lg font-bold mb-4">
            <span>Total:</span>
            <span id="cartTotal" class="text-green-600">R$ 0,00</span>
          </div>
          <button onclick="completeSale()" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-bold">Finalizar Venda</button>
        </div>
      </div>
    </div>

    <!-- Estoque -->
    <div id="tab-estoque" class="hidden bg-white rounded-xl shadow-lg p-6">
      <h2 class="text-xl font-bold mb-4 text-green-800">Controle de Estoque</h2>
      <table class="w-full border">
        <thead class="bg-gray-50">
          <tr>
            <th class="p-2">Produto</th>
            <th class="p-2">Pre칞o</th>
            <th class="p-2">Estoque</th>
            <th class="p-2">Vendidos</th>
          </tr>
        </thead>
        <tbody id="stockTable"></tbody>
      </table>
    </div>

    <!-- Relat칩rios -->
    <div id="tab-relatorios" class="hidden bg-white rounded-xl shadow-lg p-6">
      <h2 class="text-xl font-bold mb-4 text-green-800">Relat칩rios</h2>
      <div id="reportList"></div>
    </div>
  </div>

  <script>
    // Produtos atualizados
    const products = [
      { id: 1, name: '츼gua s/ G치s 500ml', price: 2.00, stock: 100, sold: 0 },
      { id: 2, name: '츼gua c/ G치s 500ml', price: 3.00, stock: 50, sold: 0 },
      { id: 3, name: 'Refrigerante 350ml', price: 5.00, stock: 60, sold: 0 },
      { id: 4, name: 'Amstel 350ml', price: 6.00, stock: 40, sold: 0 },
      { id: 5, name: 'Vinho Ideologia Assemblage Batalha', price: 50.00, stock: 20, sold: 0 },
      { id: 6, name: 'Espumante Nature Forte Santa Tecla', price: 70.00, stock: 10, sold: 0 }
    ];

    let sales = JSON.parse(localStorage.getItem("sales")) || [];
    let cart = [];

    document.getElementById("eventDate").innerText = new Date().toLocaleDateString("pt-BR");

    // Renderizar produtos
    function renderProducts() {
      const list = document.getElementById("productList");
      list.innerHTML = "";
      products.forEach(p => {
        list.innerHTML += `
          <div class="border rounded-lg p-4 ${p.stock === 0 ? 'opacity-50' : ''}">
            <div class="flex justify-between">
              <h3>${p.name}</h3>
              <span class="font-bold text-green-600">R$ ${p.price.toFixed(2)}</span>
            </div>
            <p class="text-sm">Estoque: ${p.stock}</p>
            <button onclick="addToCart(${p.id})" ${p.stock === 0 ? 'disabled' : ''} class="mt-2 w-full bg-green-600 text-white py-1 rounded">
              ${p.stock === 0 ? 'Sem Estoque' : 'Adicionar'}
            </button>
          </div>`;
      });
    }

    // Carrinho
    function addToCart(id) {
      const product = products.find(p => p.id === id);
      if (!product || product.stock === 0) return;
      const existing = cart.find(i => i.id === id);
      if (existing) {
        existing.quantity++;
      } else {
        cart.push({ ...product, quantity: 1 });
      }
      renderCart();
    }

    function changeQuantity(id, delta) {
      const item = cart.find(i => i.id === id);
      if (!item) return;
      item.quantity += delta;
      if (item.quantity <= 0) {
        cart = cart.filter(i => i.id !== id);
      }
      renderCart();
    }

    function removeFromCart(id) {
      cart = cart.filter(i => i.id !== id);
      renderCart();
    }

    function renderCart() {
      const cartItems = document.getElementById("cartItems");
      const cartCount = document.getElementById("cartCount");
      const cartTotal = document.getElementById("cartTotal");
      cartItems.innerHTML = "";
      let total = 0, count = 0;
      cart.forEach(item => {
        total += item.price * item.quantity;
        count += item.quantity;
        cartItems.innerHTML += `
          <div class="flex justify-between items-center bg-gray-50 p-2 rounded">
            <span>${item.name}</span>
            <div class="flex items-center gap-2">
              <button onclick="changeQuantity(${item.id}, -1)" class="px-2 bg-red-500 text-white rounded">-</button>
              <span>${item.quantity}</span>
              <button onclick="changeQuantity(${item.id}, 1)" class="px-2 bg-green-500 text-white rounded">+</button>
              <button onclick="removeFromCart(${item.id})" class="px-2 bg-gray-600 text-white rounded">x</button>
            </div>
          </div>`;
      });
      cartCount.innerText = count;
      cartTotal.innerText = "R$ " + total.toFixed(2);
    }

    // Finalizar venda
    function completeSale() {
      if (cart.length === 0) return;
      let total = 0;
      cart.forEach(item => {
        total += item.price * item.quantity;
        const p = products.find(pr => pr.id === item.id);
        p.stock -= item.quantity;
        p.sold += item.quantity;
      });
      sales.push({ id: Date.now(), total, items: [...cart] });
      localStorage.setItem("sales", JSON.stringify(sales));
      cart = [];
      renderProducts();
      renderCart();
      renderStats();
      alert("Venda conclu칤da! Total R$ " + total.toFixed(2));
    }

    // Estoque
    function renderStock() {
      const table = document.getElementById("stockTable");
      table.innerHTML = "";
      products.forEach(p => {
        table.innerHTML += `
          <tr>
            <td class="p-2">${p.name}</td>
            <td class="p-2">R$ ${p.price.toFixed(2)}</td>
            <td class="p-2">${p.stock}</td>
            <td class="p-2">${p.sold}</td>
          </tr>`;
      });
    }

    // Relat칩rios
    function renderReports() {
      const div = document.getElementById("reportList");
      div.innerHTML = "";
      sales.forEach((s, index) => {
        div.innerHTML += `
          <div class="border p-2 mb-2 rounded flex justify-between items-center">
            <span>Venda #${index + 1} - R$ ${s.total.toFixed(2)}</span>
            <button onclick="removeSale(${index})" class="px-2 py-1 bg-red-500 text-white rounded">Remover</button>
          </div>`;
      });
    }

    function removeSale(index) {
      const sale = sales[index];
      // devolve estoque
      sale.items.forEach(item => {
        const p = products.find(pr => pr.id === item.id);
        if (p) {
          p.stock += item.quantity;
          p.sold -= item.quantity;
        }
      });
      sales.splice(index, 1);
      localStorage.setItem("sales", JSON.stringify(sales));
      renderReports();
      renderProducts();
      renderStats();
    }

    // Stats
    function renderStats() {
      const totalRevenue = sales.reduce((sum, s) => sum + s.total, 0);
      const totalItems = products.reduce((sum, p) => sum + p.sold, 0);
      document.getElementById("totalRevenue").innerText = "R$ " + totalRevenue.toFixed(2);
      document.getElementById("totalSales").innerText = sales.length;
      document.getElementById("totalItemsSold").innerText = totalItems;
    }

    // Tabs
    function showTab(tab) {
      ["vendas","estoque","relatorios"].forEach(t => {
        document.getElementById("tab-"+t).classList.add("hidden");
      });
      document.getElementById("tab-"+tab).classList.remove("hidden");
      if (tab === "estoque") renderStock();
      if (tab === "relatorios") renderReports();
    }

    // Inicializa칞칚o
    renderProducts();
    renderCart();
    renderStats();
  </script>
</body>
</html>
